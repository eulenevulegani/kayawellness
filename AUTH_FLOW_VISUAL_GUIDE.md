# KAYA Authentication Flow - Visual Guide

## ğŸŒŸ Complete User Journey Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LANDING PAGE                             â”‚
â”‚  ğŸŒŒ "Your Calm Universe" - Hero Section                        â”‚
â”‚                                                                 â”‚
â”‚  [Start Free Trial]  or  [Log In]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                  â”‚
        New User â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€ Returning User
                      â”‚                             â”‚
                      â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   9-STEP ONBOARDING SETUP   â”‚   â”‚    AUTH SCREEN (LOGIN)   â”‚
    â”‚   â˜€ï¸ You Are The Sun        â”‚   â”‚                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  Email: [________]       â”‚
                      â”‚                â”‚  Password: [________]    â”‚
         Step 1: ğŸŒŒ Welcome           â”‚                          â”‚
         Step 2: â­ Goals             â”‚  [Login]                 â”‚
         Step 3: ğŸª Experience        â”‚                          â”‚
         Step 4: ğŸŒ Demographics      â”‚  "Create Your Universe"  â”‚
         Step 5: â˜„ï¸ Rhythm            â”‚  (redirects to Setup)    â”‚
         Step 6: ğŸµ Voice             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         Step 7: ğŸŒŸ Check-ins                     â”‚
         Step 8: ğŸŒ Schedule                      â”‚
         Step 9: â˜€ï¸ YOU (center!)                 â”‚
                  - Name                          â”‚
                  - Email                         â”‚
                  - Password                      â”‚
                      â”‚                           â”‚
                      â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚  SIGNUP (Backend Call)      â”‚              â”‚
    â”‚  Creates Supabase account   â”‚              â”‚
    â”‚  Sends verification email   â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                      â”‚                           â”‚
                      â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚  VERIFICATION SCREEN        â”‚              â”‚
    â”‚  âœ‰ï¸ Email sent to user      â”‚              â”‚
    â”‚                             â”‚              â”‚
    â”‚  Enter 6-digit code:        â”‚              â”‚
    â”‚  [_] [_] [_] [_] [_] [_]   â”‚              â”‚
    â”‚                             â”‚              â”‚
    â”‚  [Verify & Enter KAYA]      â”‚              â”‚
    â”‚  [Resend Code]              â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                      â”‚                           â”‚
                      â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚  VERIFY EMAIL (Backend)     â”‚              â”‚
    â”‚  Validates OTP code         â”‚              â”‚
    â”‚  Creates session            â”‚              â”‚
    â”‚  Saves profile to DB        â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                      â”‚                           â”‚
                      â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚  SPLASH SCREEN              â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  ğŸŒŸ Animated universe       â”‚   (after login)
    â”‚  "Welcome to KAYA"          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SETUP COMPLETE SCREEN      â”‚
    â”‚  (New users only)           â”‚
    â”‚  "Your universe awaits!"    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     DASHBOARD (HOME)        â”‚
    â”‚  ğŸ  Journey                 â”‚
    â”‚  ğŸ“š Explore                 â”‚
    â”‚  âœï¸ Journal                 â”‚
    â”‚  ğŸŒŒ Universe                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ Key Components

### 1. Landing Page (`LandingPage.tsx`)
- Entry point for all users
- "Start Free Trial" â†’ Setup (new users)
- "Log In" â†’ Auth Screen (existing users)

### 2. Setup Component (`Setup.tsx`)
- 9 progressive steps
- Collects all user preferences
- Final step (9) = user credentials
- Returns profile + password to App

### 3. Auth Screen (`AuthScreen.tsx`)
- Login-only interface
- Simplified from previous version
- "Create Your Universe" redirects to Setup

### 4. Verification Screen (`VerificationScreen.tsx`)
- Beautiful 6-digit OTP input
- Auto-focus and keyboard navigation
- Paste support
- Resend functionality
- Error handling

### 5. Auth Service (`auth.service.ts`)
```typescript
// New Methods:
- signup() â†’ { needsVerification: true, email }
- verifyEmail(email, code) â†’ UserProfile
- resendVerificationEmail(email) â†’ void
```

## ğŸ¯ State Flow in App.tsx

```typescript
// Onboarding Flow States
pendingVerificationEmail: string        // Email waiting for verification
pendingSetupProfile: UserProfile | null // Profile to save after verification

// Process:
1. User completes Setup â†’ calls handleSetupComplete(profile, password)
2. handleSetupComplete calls authService.signup()
3. Sets pendingVerificationEmail & pendingSetupProfile
4. Navigates to 'auth' view
5. Auth view detects pendingVerificationEmail
6. Shows VerificationScreen instead of AuthScreen
7. User enters code â†’ calls authService.verifyEmail()
8. Calls handleEmailVerified() to save profile
9. Shows splash screen
10. Navigates to setupComplete â†’ dashboard
```

## ğŸ¨ Visual Highlights

### Step 9 - The Sun â˜€ï¸
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚         ğŸŒ (Large Sun Icon)         â”‚
â”‚      Golden gradient background     â”‚
â”‚                                     â”‚
â”‚     "You Are The Sun"               â”‚
â”‚  â˜€ï¸ The Center of Your Universe     â”‚
â”‚                                     â”‚
â”‚  You've journeyed through 8         â”‚
â”‚  celestial realms. Now place        â”‚
â”‚  yourself at the centerâ€”radiant,    â”‚
â”‚  powerful, and complete.            â”‚
â”‚                                     â”‚
â”‚  Name:     [______________]         â”‚
â”‚  Email:    [______________]         â”‚
â”‚  Password: [______________]         â”‚
â”‚                                     â”‚
â”‚  [â˜€ï¸ Illuminate Your Universe]      â”‚
â”‚     (Golden gradient button)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Verification Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸŒŸ KAYA Logo                â”‚
â”‚                                     â”‚
â”‚     Verify Your Email               â”‚
â”‚                                     â”‚
â”‚  We sent a 6-digit code to          â”‚
â”‚  user@example.com                   â”‚
â”‚                                     â”‚
â”‚  [_] [_] [_] [_] [_] [_]           â”‚
â”‚   â†‘ Auto-focus, paste support       â”‚
â”‚                                     â”‚
â”‚  [Verify & Enter KAYA]              â”‚
â”‚                                     â”‚
â”‚  Didn't receive the code?           â”‚
â”‚  [Resend Code]                      â”‚
â”‚                                     â”‚
â”‚  ğŸ’¡ Check spam folder               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Features

âœ… **Email Verification Required** - No unverified accounts
âœ… **Supabase OTP** - Industry-standard verification
âœ… **Password Requirements** - Minimum 8 characters
âœ… **Session Management** - Proper auth state handling
âœ… **Secure Token Storage** - Handled by Supabase
âœ… **Rate Limiting** - Built into Supabase auth

## ğŸš€ Benefits

### For Users:
- âœ¨ Beautiful, meaningful onboarding experience
- ğŸ¯ Clear progress tracking (9 steps)
- ğŸ”’ Secure account creation
- ğŸ“§ Email confirmation for peace of mind
- ğŸŒŒ Thematic journey (you = the sun!)

### For Platform:
- âœ… Valid email addresses only
- âœ… Reduced spam/fake accounts
- âœ… Better user data quality
- âœ… Improved security posture
- âœ… Professional user experience

## ğŸ“ Testing Checklist

- [ ] Complete all 9 onboarding steps
- [ ] Receive verification email
- [ ] Enter correct 6-digit code
- [ ] Successfully create account
- [ ] See splash screen
- [ ] Land on dashboard
- [ ] Try resending code
- [ ] Test invalid code error
- [ ] Test expired code handling
- [ ] Login with created account
- [ ] Logout and login again

---

**Implementation Complete! âœ¨**

The KAYA onboarding experience now guides users through 9 celestial steps, with them as the radiant sun at the center, followed by secure email verification before entering their wellness universe.
